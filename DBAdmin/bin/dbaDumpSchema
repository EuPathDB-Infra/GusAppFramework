#!/usr/bin/perl

use Carp;

my $GUS_HOME=$ENV{GUS_HOME};
my $PROJECT_HOME=$ENV{'PROJECT_HOME'};

my $javaDir = "$GUS_HOME/lib/java";

opendir(DATADIR, $javaDir) || &confess ("Error:  Could not open $javaDir.  Please check the directory exists and try again.");

my $CLASSPATH = "";

while (my $nextFileName = readdir(DATADIR)){
    if ($nextFileName =~ /.*\.jar$/){
	$CLASSPATH .= "$javaDir/$nextFileName" . ":"
    }
}

my $args = "";
foreach my $arg (@ARGV) {
    $args .= ($arg =~ /\-/ ? " $arg" : " \"$arg\"");
}

my $cmd = "java -Xmx512m -DcmdName=dbaDumpSchema -Dlog4j.configuration=file:$PROJECT_HOME/install/log4j.properties -DPROPERTYFILE=$PROJECT_HOME/install/gus.config -classpath $CLASSPATH:$PROJECT_HOME/install/ org.gusdb.dbadmin.cmd.SchemaDumper $args";

system($cmd);
