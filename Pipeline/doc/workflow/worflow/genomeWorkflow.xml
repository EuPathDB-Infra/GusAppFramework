<workflow name="standardGenomeAnalysis">
  <params>
    <param name="genomeName"/>
    <param name="genomeExtDb"/>
    <param name="genomeExtDbRls"/>
    <param name="tigrVersion"/>
    <param name="soVersion"/>
    <param name="nrdbVersion"/>
    <param name="taxonomyVersion"/>
    <param name="computeClusterQueue"/>
  </param>

  <constants>
    <constant name="Pf">Pfalciparum</constant>
    <constant name="Pb">Pberghei</constant>
    <constant name="Pv">Pvivax</constant>
    <constant name="Py">Pyoelii</constant>
    <constant name="genomeExtDbRlsSpec">${genomeExtDb}:${genomeExtDbRls}</constant>
    <constant name="soExtDbRlsSpec">SequenceOntology:${soVersion}</constant>
    <constant name="tigrExtDbRlsSpec">tigr:${tigrVersion}</constant>
    <constant name="taxonomyExtDbRlsSpec">tigr:${tigrVersion}</constant>
    <constant name="nrdbFile">seqfiles/nr.fsa</constant>
    <constant name="proteinsFile">seqfiles/${genomeName}AnnotatedProteins.fsa</constant>
  </constants>

  <steps>
    <step name="NRDB" subflow="resource" global="true">
      <configValue name="nrdbVersion">$$$nrdbVersion</configValue>
      <configValue name="nrdbFile">$$$nrdbFile</configValue>
    </step>

    <step name="taxonomy" subflow="resource" global="true"/>
      <configValue name="extDbRlsSpec">$$$taxonmyExtDbRlsSpec</configValue>
    </step>

    <step name="SO" subflow="resource" global="true">
      <configValue name="extDbRlsSpec">$$$soExtDbRlsSpec</configValue>
    </step>

    <step name="genome" subflow="resource">
      <configValue name="extDbRlsSpec">$$$genomeExtDbRlsSpec</configValue>
    </step>

    <step name="TIGR" subflow="resource">
      <configValue name="extDbRlsSpec">$$$tigrExtDbRlsSpec</configValue>
    </step>

    <step name="splign" subflow="splign">
      <include match="$$$genomeName" list="@@@Pf,@@@Pb,@@@Py,@@@Pv"/>
      <configValue name="genomeName">$$$genomeName</configValue>
      <configValue name="queryExtDbRlsSpec">$$$tigrExtDbRlsSpec</configValue>
      <depends step="genome"/>
      <depends step="TIGR"/>
    </step>

    <step name="calcTranslatedProteins"
          class="">
      <include match="$$$genomeName" list="@@@Pf,@@@Pb,@@@Py,@@@Pv"/>
      <configValue name="genomeExtDbRlsSpec">$$$genomeExtDbRlsSpec</configValue>
      <configValue name="soExtDbRlsSpec">$$$soExtDbRlsSpec</configValue>
      <depends step="genome"/>
    </step>

    <step name="extractProteins"
          class="">
      <configValue name="genomeName">$$$genomeName</configValue>
      <configValue name="genomeExtDbRlsSpec">$$$genomeExtDbRlsSpec</configValue>
      <configValue name="outputFile">${genomeName}$geneExtDbRls</configValue>
      <depends step="calcTranslatedProteins"/>
    </step>

    <step name="psipred" subflow="psipred">
      <configValue name="genomeName">$$$genomeName</configValue>
      <configValue name="nrdbFile">$$$nrdbFile</configValue>
      <configValue name="proteinsFile">$$$proteinsFile</configValue>
      <configValue name="queue">$$$computeClusterQueue</configValue>
      <depends step="extractProteins"/>
      <depends step="nrdb"/>
    </step>


  </steps>
</workflow>
