<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <title>Setup ssh-agent for sanger CVS</title>
  <meta http-equiv="content-type"
 content="text/html; charset=ISO-8859-1">
</head>
<body>
<div align="center">
<h1>Setting up an ssh-agent to cvs.sanger.ac.uk<br>
</h1>
</div>
  
<blockquote>   
  <ol>
    <li>set up .ssh/authorized_keys on your local machine</li>
    <ol>
      <li><tt>mkdir $HOME/.ssh</tt> (unless already there)</li>
      <li><tt>cd $HOME/.ssh</tt><br>
       </li>
      <li>if you have an <tt>authorized_keys</tt> file and an <tt>identity.pub</tt>
file, see if <tt>authorized_keys</tt> contains the text from identity.pub</li>
      <li>if not</li>
      <ol>
        <li><tt>ssh-keygen -t rsa1</tt> &nbsp; &nbsp;(use your standard passphrase)
&nbsp;(this produces the identity.pub file)</li>
        <li><tt>cat identity.pub &gt;&gt; authorized_keys</tt> &nbsp; (appends)</li>
      </ol>
    </ol>
    <li>get that file into your sanger home</li>
    <ol>
      <li>on your local machine:</li>
      <ol>
        <li><tt>emacs authorized_keys</tt></li>
        <li>select and copy the contents of that file (make sure you haven't
introduced incorrect newlines)</li>
        <li><tt>ssh cvs.sanger.ac.uk </tt>(to get to the sanger machine)<br>
        </li>
      </ol>
      <li>on the sanger machine:<br>
      </li>
      <ol>
        <li><tt>mkdir .ssh</tt></li>
        <li><tt>emacs .ssh/authorized_keys</tt></li>
        <li>paste what you had copied into your clipboard</li>
        <li>save the file</li>
        <li>logout from sanger<br>
        </li>
      </ol>
    </ol>
    <li>test ssh to sanger from your local machine:</li>
    <ol>
      <li><tt>ssh -1 cvs.sanger.ac.uk</tt></li>
      <li>it should ask you for your passphrase (not a password)</li>
      <li>if it doesn't debug by using<tt> ssh -1 -v cvs.sanger.ac.uk &nbsp;</tt></li>
    </ol>
    <li>create the ssh1 command (if you don't already have an ssh1 command)<br>
    </li>
    <ol>
      <li>in a <tt>bin/</tt> directory that is in your path, and that you
can write to, do this:</li>
      <li><tt>echo "ssh -1 $*" &gt; ssh1</tt></li>
      <li><tt>chmod +x ssh1</tt></li>
      <li><tt>rehash</tt></li>
      <li>now test ssh1:</li>
      <ol>
        <li><tt>ssh1 cvs.sanger.ac.uk</tt><br>
        </li>
      </ol>
    </ol>
    <li>setup the <tt>CVS_RSH</tt> variable, in your .login or .cshrc</li>
    <ol>
      <li><tt>setenv CVS_RSH ssh1</tt></li>
      <li>now open a new terminal window so that the change will take effect
(or use the <tt>source</tt> command)<br>
      </li>
      <li>test that:</li>
      <ol>
        <li>cd to a directory that was checked out from sanger</li>
        <li><tt>cvs update</tt></li>
        <li>it should ask you for a passphrase<br>
        </li>
      </ol>
    </ol>
    <li>start up your agent:</li>
    <ol>
      <li><tt>eval `ssh-agent`</tt></li>
      <li><tt>ssh-add</tt></li>
    </ol>
    <li>test cvs again. &nbsp;this time it should not ask for a passphrase
or password</li>
    <li>to alert a new terminal window to the presence of the agent:</li>
    <ol>
      <li>in the terminal in which the agent is already running:</li>
      <ol>
        <li>env | grep SSH_A</li>
      </ol>
      <li>in the new terminal</li>
      <ol>
        <li>set the environment following environment variables with the
values from the first terminal</li>
        <ol>
          <li>SSH_AUTH_SOCK</li>
          <li>SSH_AGENT_PID<br>
          </li>
        </ol>
      </ol>
    </ol>
  </ol>
</blockquote>
<blockquote> </blockquote>
</body>
</html>
