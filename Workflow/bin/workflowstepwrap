#!/usr/bin/perl

use strict;
use lib "$ENV{GUS_HOME}/lib/perl";

usage() unless scalar(@ARGV) >= 5;

my $homeDir = shift(@ARGV);
my $workflowId = shift(@ARGV);
my $stepName = shift(@ARGV);
my $invokerClass = shift(@ARGV);
my $errFile =  shift(@ARGV);
my $paramStrings = \@ARGV;

open (STDERR, ">>$errFile");


my $stepInvoker =  eval "{require $invokerClass; $invokerClass->new('$homeDir')}";
die($@) if $@;

$stepInvoker->setParamValues($paramStrings);

my $status = $stepInvoker->runInWrapper($workflowId, $stepName);

exit($status);

sub usage {
    print "
Caution!! this program is only called by the workflow controller

usage: workflowstepwrap workflow_dir workflow_id stepname stepclass errfile param1name=param1value ...
";
    exit(1);
}




